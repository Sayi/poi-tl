= Poi-tl Documentation
Sayi <adasai90@gmail.com>
v1.7.3 
:description: wordæ¨¡æ¿å¼•æ“
:keywords: poi,word,docx,template,æ¨¡æ¿,å¯¼å‡º
:doctype: book
:encoding: utf-8
:lang: en
:toc: left
// :toclevels: 3
:icons: font
:source-highlighter: prettify
:numbered:
:nofooter:
:sectlinks:
:sectanchors:

[example]
--
å…³äºæ–‡æ¡£ï¼šv1.7.xå¹¶éæœ€æ–°ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨poi-tlæœ€æ–°ç‰ˆæœ¬ï¼šlink:http://deepoove.com/poi-tl[poi-tl æœ€æ–°æ–‡æ¡£, window=_blank]ã€‚
--

poi-tlï¼ˆpoi template languageï¼‰æ˜¯Wordæ¨¡æ¿å¼•æ“ï¼ŒåŸºäºMicrosoft Wordæ¨¡æ¿å’Œæ•°æ®ç”Ÿæˆæ–°çš„æ–‡æ¡£ã€‚

[quote]
____
åœ¨æ–‡æ¡£çš„ä»»ä½•åœ°æ–¹åšä»»ä½•äº‹æƒ…ï¼ˆ_Do Anything Anywhere_ï¼‰æ˜¯poi-tlçš„æ˜Ÿè¾°å¤§æµ·ã€‚
____

== Why poi-tl
|===
| æ–¹æ¡ˆ | ç§»æ¤æ€§ |  åŠŸèƒ½æ€§  | æ˜“ç”¨æ€§
| **Poi-tl** | Javaè·¨å¹³å° | Wordæ¨¡æ¿å¼•æ“ | åŸºäºApache POI
| Apache POI | Javaè·¨å¹³å° | Apacheé¡¹ç›®ï¼ŒåŠŸèƒ½ä¸°å¯Œ | æ–‡æ¡£ä¸å…¨ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ•™ç¨‹ï¼šlink:http://deepoove.com/poi-tl/apache-poi-guide.html[Apache POI Wordå¿«é€Ÿå…¥é—¨ , window=_blank]
| Freemarker | XMLè·¨å¹³å° | ä»…æ”¯æŒæ–‡æœ¬ï¼Œå¾ˆå¤§çš„å±€é™æ€§ | å¤æ‚ï¼Œéœ€è¦ç»´æŠ¤XMLç»“æ„ï¼ŒåŸºæœ¬ä¸å¯è¿­ä»£
| OpenOffice | éƒ¨ç½²OpenOfficeè½¯ä»¶ï¼Œç§»æ¤æ€§è¾ƒå·® | - | å¤æ‚ï¼Œéœ€è¦äº†è§£OpenOfficeçš„API
| HTMLæµè§ˆå™¨å¯¼å‡º | ä¾èµ–æµè§ˆå™¨çš„å®ç°ï¼Œç§»æ¤æ€§è¾ƒå·® | HTMLä¸èƒ½å¾ˆå¥½çš„å…¼å®¹Wordçš„æ ¼å¼ | -
| Jacobã€winlib | Windowså¹³å° | - | å¤æ‚ï¼Œä¸æ¨èä½¿ç”¨
|===

æ“ä½œWordæ–‡æ¡£æœ€å¼ºå¤§çš„æ–¹å¼è¦ä¹ˆæ˜¯ç›´æ¥æ“ä½œåº•å±‚çš„æ–‡æ¡£ç»“æ„ï¼Œè¦ä¹ˆå€ŸåŠ©ä¸€ä¸ªç›´æ¥æ“ä½œåº•å±‚æ–‡æ¡£ç»“æ„çš„ç±»åº“ï¼ŒApache POIä¸ä»…åœ¨ä¸Šå±‚å°è£…äº†æ˜“ç”¨çš„API(æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼ã€é¡µçœ‰ã€é¡µè„šç­‰)ï¼Œä¹Ÿå¯ä»¥åœ¨åº•å±‚ç›´æ¥æ“ä½œæ–‡æ¡£ç»“æ„ã€‚

**poi-tl**æ­£æ˜¯ä¸€ä¸ªåŸºäºApache POIçš„Wordæ¨¡æ¿å¼•æ“ï¼Œå¹¶ä¸”æ‹¥æœ‰ç€è®©äººå–œæ‚¦çš„ç‰¹æ€§ã€‚

[frame=none]
[grid=rows]
[cols=",", options="header", stripes=none]
|===
|å¼•æ“åŠŸèƒ½ |æè¿°
|icon:check[role="green"]æ–‡æœ¬ |å°†æ ‡ç­¾æ¸²æŸ“ä¸ºæ–‡æœ¬
|icon:check[role="green"]å›¾ç‰‡ |å°†æ ‡ç­¾æ¸²æŸ“ä¸ºå›¾ç‰‡
|icon:check[role="green"]è¡¨æ ¼ |å°†æ ‡ç­¾æ¸²æŸ“ä¸ºè¡¨æ ¼
|icon:check[role="green"]åˆ—è¡¨ |å°†æ ‡ç­¾æ¸²æŸ“ä¸ºåˆ—è¡¨
|icon:check[role="green"]If Conditionåˆ¤æ–­ |éšè—æˆ–è€…æ˜¾ç¤ºæŸäº›æ–‡æ¡£å†…å®¹ï¼ˆåŒ…æ‹¬æ–‡æœ¬ã€æ®µè½ã€å›¾ç‰‡ã€è¡¨æ ¼ã€åˆ—è¡¨ç­‰ï¼‰
|icon:check[role="green"]Foreach Loopå¾ªç¯ |å¾ªç¯æŸäº›æ–‡æ¡£å†…å®¹ï¼ˆåŒ…æ‹¬æ–‡æœ¬ã€æ®µè½ã€å›¾ç‰‡ã€è¡¨æ ¼ã€åˆ—è¡¨ç­‰ï¼‰
|icon:check[role="green"]Loopè¡¨æ ¼è¡Œ |å¾ªç¯æ¸²æŸ“è¡¨æ ¼çš„æŸä¸€è¡Œ
|icon:check[role="green"]Loopæœ‰åºåˆ—è¡¨ |æ”¯æŒæœ‰åºåˆ—è¡¨çš„å¾ªç¯ï¼ŒåŒæ—¶æ”¯æŒå¤šçº§åˆ—è¡¨
|icon:check[role="green"]ä¹¦ç­¾ã€é”šç‚¹ã€è¶…é“¾æ¥ |æ”¯æŒè®¾ç½®ä¹¦ç­¾ï¼Œæ–‡æ¡£å†…é”šç‚¹å’Œè¶…é“¾æ¥åŠŸèƒ½
|icon:check[role="green"]å›¾ç‰‡æ›¿æ¢ |å°†åŸæœ‰å›¾ç‰‡æ›¿æ¢æˆå¦ä¸€å¼ å›¾ç‰‡
|icon:check[role="green"]å¼ºå¤§çš„è¡¨è¾¾å¼ |å®Œå…¨æ”¯æŒSpringELè¡¨è¾¾å¼ï¼Œå¯ä»¥æ‰©å±•æ›´å¤šçš„è¡¨è¾¾å¼ï¼šOGNL, MVEL...
|icon:check[role="green"]æ ‡ç­¾å®šåˆ¶ |æ”¯æŒè‡ªå®šä¹‰æ ‡ç­¾å‰åç¼€
|icon:check[role="green"]æ ·å¼ |æ¨¡æ¿å³æ ·å¼ï¼ŒåŒæ—¶ä»£ç ä¹Ÿå¯ä»¥è®¾ç½®æ ·å¼
|icon:check[role="green"]æ¨¡æ¿åµŒå¥— |æ¨¡æ¿åŒ…å«å­æ¨¡æ¿ï¼Œå­æ¨¡æ¿å†åŒ…å«å­æ¨¡æ¿
|icon:check[role="green"]Mergeåˆå¹¶ |Wordåˆå¹¶ï¼Œå¯ä»¥åœ¨æŒ‡å®šä½ç½®è¿›è¡Œåˆå¹¶
|icon:check[role="green"]ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(æ’ä»¶) |åœ¨æ–‡æ¡£ä»»ä½•ä½ç½®æ‰§è¡Œå‡½æ•°
|===

**poi-tl**æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„Javaç±»åº“ï¼Œä½ å¯ä»¥éå¸¸æ–¹ä¾¿çš„åŠ å…¥åˆ°ä½ çš„Javaé¡¹ç›®ä¸­ã€‚

å¦‚æœä½ å¸Œæœ›æ‰“å¼€ä¸€ä¸ªæ–‡æ¡£æˆ–è€…åˆ›å»ºä¸€ä¸ªç®€å•çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆApache POIå°±å¯èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼›å¦‚æœä½ æ˜¯ä¸€ä¸ªéœ€è¦å°†æ•°æ®å¯¼å‡ºæˆWordæ–‡æ¡£çš„å¼€å‘è€…ï¼Œä¸å¦¨è¯•è¯•poi-tlï¼›å¦‚æœä½ æ˜¯ä¸€ä¸ªæ­å»ºWordæ¨¡æ¿äº‘æœåŠ¡çš„å¼€å‘è€…ï¼Œä¸å¦¨è¯•è¯•poi-tlï¼›å¦‚æœä½ å¼€å‘çš„æŸä¸ªè½¯ä»¶æ”¯æŒå¯¼å‡ºHTMLã€Markdownï¼Œä¸å¦¨ä½¿ç”¨poi-tlä¸ºä½ çš„è½¯ä»¶æ·»åŠ å¯¼å‡ºWordçš„åŠŸèƒ½ã€‚

== è½¯ä»¶è¦æ±‚
* Apache POI4.0.0+
* JDK1.8+

== å†å²ç‰ˆæœ¬
ç‚¹å‡»ä¸‹æ–¹é“¾æ¥æŸ¥é˜…poi-tlå†å²ç‰ˆæœ¬æ–‡æ¡£ï¼Œå…¶ä¸­v1.5.xæ˜¯æ„å»ºåœ¨Apache poi3.16+å’ŒJDK1.6+ä¸Šçš„ç‰ˆæœ¬ï¼š

* link:http://deepoove.com/poi-tl/1.6.x/[1.6.x Documentation , window=_blank]
* link:http://deepoove.com/poi-tl/1.5.x/[1.5.x Documentation, window=_blank]

== Getting Started
=== Maven
[source, xml]
----
<dependency>
  <groupId>com.deepoove</groupId>
  <artifactId>poi-tl</artifactId>
  <version>1.7.3</version>
</dependency>
----

=== Gradle 
[source, groovy]
compile group: 'com.deepoove', name: 'poi-tl', version: '1.7.3'

=== 2minå¿«é€Ÿå…¥é—¨
æ–°å»ºWordæ¨¡æ¿template.docxï¼ŒåŒ…å«æ ‡ç­¾ `{{title}}`
[example]
--
.template.docx
{{title}}
--

[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
XWPFTemplate template = XWPFTemplate.compile("template.docx").render(new HashMap<String, Object>(){{ <1> <2>
        put("title", "poi-tl Wordæ¨¡æ¿å¼•æ“");
}});
FileOutputStream out = new FileOutputStream("output.docx");
template.write(out); <3>
out.flush();
out.close();
template.close();
----
<1> ç¼–è¯‘æ¨¡æ¿
<2> æ¸²æŸ“æ•°æ®
<3> è¾“å‡ºåˆ°æµ

*TDOæ¨¡å¼ï¼šTemplate + data-model = output*
--

[example]
--
.output.docx
poi-tl Wordæ¨¡æ¿å¼•æ“
--

=== Templateï¼šæ¨¡æ¿
æ¨¡æ¿æ˜¯docxæ ¼å¼çš„Wordæ–‡æ¡£ï¼Œä½ å¯ä»¥ä½¿ç”¨Microsoft officeã€WPS Officeã€Pagesç­‰ä»»ä½•ä½ å–œæ¬¢çš„è½¯ä»¶åˆ¶ä½œæ¨¡æ¿ã€‚

poi-tléµå¾ª**â€œæ‰€è§å³æ‰€å¾—â€**çš„è®¾è®¡ï¼Œæ¨¡æ¿çš„æ ·å¼ä¼šè¢«å®Œå…¨ä¿ç•™ï¼Œæ ‡ç­¾çš„æ ·å¼ä¹Ÿä¼šåº”ç”¨åœ¨æ›¿æ¢åçš„æ–‡æœ¬ä¸Šã€‚

poi-tlæ˜¯ä¸€ç§ "logic-less" æ¨¡æ¿å¼•æ“ï¼Œæ²¡æœ‰å¤æ‚çš„æ§åˆ¶ç»“æ„å’Œå˜é‡èµ‹å€¼ï¼Œåªæœ‰æ ‡ç­¾ã€‚æ‰€æœ‰çš„æ ‡ç­¾éƒ½æ˜¯ä»¥ `{{` å¼€å¤´ï¼Œä»¥ `}}` ç»“å°¾ï¼Œæ¨¡æ¿æ ‡ç­¾å¯ä»¥å‡ºç°åœ¨ä»»ä½•éæ–‡æœ¬æ¡†çš„ä½ç½®ï¼ŒåŒ…æ‹¬é¡µçœ‰ï¼Œé¡µè„šï¼Œè¡¨æ ¼å†…éƒ¨ç­‰ç­‰ã€‚

è¡¨æ ¼å¸ƒå±€å¯ä»¥è®¾è®¡å‡ºå¾ˆå¤šä¼˜ç§€ä¸“ä¸šçš„æ–‡æ¡£ï¼Œæ¨¡æ¿æ–‡æ¡£æ¨èä½¿ç”¨è¡¨æ ¼ï¼Œæš‚ä¸æ”¯æŒæ–‡æœ¬æ¡†ã€‚

=== Data-modelï¼šæ•°æ®

> æ•°æ®æ¨¡å‹ç±»ä¼¼äºå“ˆå¸Œæˆ–å­—å…¸ã€‚

æ•°æ®å¯ä»¥æ˜¯ `Map` ï¼ˆkeyæ˜¯æ ‡ç­¾åç§°ï¼‰ï¼š
[source, java]
----
Map<String, Object> data = new HashMap<>();
data.put("name", "Sayi");
data.put("start_time", "2019-08-04");
----

æ•°æ®å¯ä»¥æ˜¯JavaBeanï¼ˆå±æ€§åæ˜¯æ ‡ç­¾åç§°ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£ `@Name` è®¾ç½®åˆ«åï¼‰ï¼š
[source, java]
----
public class MyDataModel {

  // {{name}}
  private String name;

  // {{start_time}}
  @Name("start_time")
  private String startTime;

  // {{author.XXX}},XXXæ˜¯Authorçš„å±æ€§å
  private Author author;

}
----

æ•°æ®å¯ä»¥æ˜¯æ ‘ç»“æ„ï¼Œæ¯çº§ä¹‹é—´ç”¨ç‚¹æ¥åˆ†éš”å¼€ï¼Œæ¯”å¦‚ `{{author.name}}` æ ‡ç­¾å¯¹åº”çš„æ•°æ®æ˜¯authorå¯¹è±¡çš„nameå±æ€§å€¼ã€‚

å¯¹äºå¸¸è§çš„æ–‡æœ¬æ¨¡æ¿ï¼Œæ‰€æœ‰Keyæ˜ å°„çš„Valueå€¼å¯ä»¥æ˜¯ç®€å•ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼Œæ¯”å¦‚é€šè¿‡ä¸‰ä¸ªå­—ç¬¦ä¸²å˜é‡è®¾ç½®å›¾ç‰‡è·¯å¾„ã€å®½å’Œé«˜ï¼š
[source, html]
<img src="{{path}}" width="{{width}}" height="{{height}}">

ä½†æ˜¯Wordæ–‡æ¡£ä¸æ˜¯ç”±ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“å›¾ç‰‡ã€è¡¨æ ¼ç­‰å…ƒç´ æ—¶æ•°æ®ç»“æ„ä¼šç¨å¾®å¤æ‚ç‚¹ï¼Œpoi-tlæä¾›äº†è¿™äº›æ•°æ®ç»“æ„ï¼Œå®ƒä»¬éƒ½å®ç°äº†æ¥å£ `RenderData` ï¼š

* æ–‡æœ¬æ•°æ®TextRenderDataã€HyperLinkTextRenderData
* å›¾ç‰‡æ•°æ®PictureRenderData
* è¡¨æ ¼æ•°æ®MiniTableRenderData
* åˆ—è¡¨æ•°æ®NumbericRenderData
* åµŒå¥—æ•°æ®DocxRenderData

=== Outputï¼šè¾“å‡º
æ¨¡æ¿å¼•æ“ä»¥æµçš„æ–¹å¼è¿›è¡Œè¾“å‡ºï¼š

[source, java]
----
// è¾“å‡ºæµ
template.write(OutputStream stream)

// è¾“å‡ºåˆ°æ–‡ä»¶
template.writeToFile(String path)
----

å¯ä»¥å†™åˆ°ä»»æ„è¾“å‡ºæµä¸­ï¼Œæ¯”å¦‚æ–‡ä»¶æµFileOutputStreamæˆ–ç½‘ç»œæµServletOutputStreamï¼š
[source, java]
----
response.setContentType("application/octet-stream");
response.setHeader("Content-disposition","attachment;filename=\""+"out_template.docx"+"\"");  

// HttpServletResponse response
OutputStream out = response.getOutputStream();
BufferedOutputStream bos = new BufferedOutputStream(out);
template.write(bos);
template.close();
out.flush();
out.close();
----
**æœ€åä¸è¦å¿˜è®°å…³é—­è¿™äº›æµã€‚**

== æ ‡ç­¾
æ ‡ç­¾ç”±å‰åä¸¤ä¸ªå¤§æ‹¬å·ç»„æˆï¼Œ `{{title}}` æ˜¯æ ‡ç­¾ï¼Œ `{{?title}}` ä¹Ÿæ˜¯æ ‡ç­¾ï¼Œ `title` æ˜¯è¿™ä¸ªæ ‡ç­¾çš„åç§°ï¼Œ `?` æ ‡è¯†äº†æ ‡ç­¾ç±»å‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›é»˜è®¤æ ‡ç­¾ç±»å‹(ç”¨æˆ·å¯ä»¥åˆ›å»ºæ–°çš„æ ‡ç­¾ç±»å‹ï¼Œè¿™å±äºæ›´é«˜çº§çš„è¯é¢˜)ã€‚

=== æ–‡æœ¬
[example]
--
{{var}}
--

æ•°æ®æ¨¡å‹ï¼š

- `String` ï¼šæ–‡æœ¬
- `TextRenderData` ï¼šæœ‰æ ·å¼çš„æ–‡æœ¬
- `HyperLinkTextRenderData` ï¼šè¶…é“¾æ¥æ–‡æœ¬
- `Object` ï¼šè°ƒç”¨ `toString()` æ–¹æ³•è½¬åŒ–ä¸ºæ–‡æœ¬

[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
put("name", "Sayi");
put("author", new TextRenderData("000000", "Sayi"));
// è¶…é“¾æ¥
put("link", 
  new HyperLinkTextRenderData("website", "http://deepoove.com"));
// é”šç‚¹
put("anchor", 
  new HyperLinkTextRenderData("anchortxt", "anchor:appendix1"));
----
--

æ ‡ç­¾çš„æ ·å¼ä¼šåº”ç”¨åˆ°æ›¿æ¢åçš„æ–‡æœ¬ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç è®¾å®šæ–‡æœ¬çš„æ ·å¼ã€‚

[sidebar]
.`TextRenderData` çš„ç»“æ„ä½“
--
[source, json]
----
{
  "text": "Sayi",
  "style": {
    "strike": false, <1>
    "bold": true, <2>
    "italic": false, <3>
    "color": "00FF00", <4>
    "underLine": false, <5>
    "fontFamily": "å¾®è½¯é›…é»‘", <6>
    "fontSize": 12, <7>
    "highlightColor": "green" <8>
  }
}
----
<1> åˆ é™¤çº¿
<2> ç²—ä½“
<3> æ–œä½“
<4> é¢œè‰²
<5> ä¸‹åˆ’çº¿
<6> å­—ä½“
<7> å­—å·
<8> èƒŒæ™¯é«˜äº®è‰²

--
TIP: æ–‡æœ¬æ¢è¡Œä½¿ç”¨ `\n` å­—ç¬¦ã€‚

=== å›¾ç‰‡
[example]
å›¾ç‰‡æ ‡ç­¾ä»¥@å¼€å§‹ï¼š{{@var}}

`PictureRenderData` æ•°æ®æ¨¡å‹ã€‚

[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
// æœ¬åœ°å›¾ç‰‡
put("local", new PictureRenderData(80, 100, "./sayi.png"));

// å›¾ç‰‡æµ
put("localbyte", new PictureRenderData(80, 100, ".png", new FileInputStream("./logo.png")));

// ç½‘ç»œå›¾ç‰‡ 
put("urlpicture", new PictureRenderData(50, 50, ".png", BytePictureUtils.getUrlBufferedImage("http://deepoove.com/images/icecream.png")));

// java å›¾ç‰‡
put("bufferimage", new PictureRenderData(80, 100, ".png", bufferImage)));
----
--
å›¾ç‰‡æ”¯æŒ `BufferedImage`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Javaç”Ÿæˆå›¾è¡¨æ’å…¥åˆ°wordæ–‡æ¡£ä¸­ã€‚

[sidebar]
.`PictureRenderData` çš„ç»“æ„ä½“
--
[source, json]
----
{
  "path": "", <1>
  "data": [], <2>
  "altMeta": "å›¾ç‰‡ä¸å­˜åœ¨", <3>
  "width": 100, <4>
  "height": 100 <5>
}
----
<1> å›¾ç‰‡è·¯å¾„
<2> å›¾ç‰‡ä¹Ÿå¯ä»¥æ˜¯byte[]å­—èŠ‚æ•°ç»„
<3> å½“æ— æ³•è·å–å›¾ç‰‡æ—¶å±•ç¤ºçš„æ–‡å­—
<4> å®½åº¦ï¼Œå•ä½æ˜¯åƒç´ 
<5> é«˜åº¦ï¼Œå•ä½æ˜¯åƒç´ 
--
TIP: å›¾ç‰‡æ ‡ç­¾æ— æ³•è®¾ç½®ç¯ç»•ç‰ˆå¼ï¼Œå¦‚æœå¯¹ç¯ç»•ç‰ˆå¼æœ‰æ›´é«˜çš„è¦æ±‚å¯ä»¥è‡ªå®šä¹‰å›¾ç‰‡æ’ä»¶è¿›è¡Œè®¾ç½®ï¼Œæˆ–è€…é‡‡ç”¨æ›¿æ¢å ä½å›¾ç‰‡æ–¹å¼ï¼šlink:#ref-policy-section[å¼•ç”¨æ’ä»¶]ã€‚

=== è¡¨æ ¼
[example]
è¡¨æ ¼æ ‡ç­¾ä»¥#å¼€å§‹ï¼š{{#var}}

poi-tlé»˜è®¤å®ç°äº†Nè¡ŒNåˆ—çš„æ ·å¼(å¦‚ä¸‹å›¾)ï¼ŒåŒæ—¶æä¾›äº†å½“æ•°æ®ä¸ºç©ºæ—¶ï¼Œå±•ç¤ºä¸€è¡Œç©ºæ•°æ®çš„æ–‡æ¡ˆ(å¦‚ä¸‹å›¾ä¸­çš„No Data Descs)ï¼Œæ•°æ®æ¨¡å‹æ˜¯ `MiniTableRenderData` ã€‚

image::.././table0.png[align='center']

[sidebar]
.`MiniTableRenderData` çš„ç»“æ„ä½“
--
[source, json]
----
{
  "rows": [ <1>
    {
      "cells": [ <2>
        {
          "cellText": [TextRenderData],
          "cellStyle": { <3>
            "align": "center", 
            "backgroundColor": "ff9800"
          }
        }
      ],
      "rowStyle": { <4>
        "align": "center", 
        "backgroundColor": "ff9800"
      }
    }
  ],
  "header": { <5>
    "cells": [
      {
        "cellText": [TextRenderData],
        "cellStyle": { 
          "align": "center", 
          "backgroundColor": "ff9800"
        }
      }
    ],
    "rowStyle": { <4>
      "align": "center", 
      "backgroundColor": "ff9800"
    }
  },
  "noDatadesc": "No Data Desc", <6>
  "style": { <7>
      "align": "center"
    }
  "width": 14.65 <8>
}
----
<1> å®šä¹‰è¡¨æ ¼è¡Œæ•°æ®
<2> å®šä¹‰å•å…ƒæ ¼æ•°æ®ï¼Œæ•°æ®ç”± `TextRenderData` æŒ‡å®š
<3> å•å…ƒæ ¼æ ·å¼ï¼šå¯¹é½æ–¹å¼ï¼ŒèƒŒæ™¯è‰²
<4> è¡Œæ ·å¼ï¼šè¡Œæ•°æ®çš„å¯¹é½æ–¹å¼ï¼Œè¡ŒèƒŒæ™¯è‰²
<5> å®šä¹‰è¡¨æ ¼å¤´
<6> æ²¡æœ‰æ•°æ®çš„å±•ç¤ºæ–‡æ¡ˆ
<7> è¡¨æ ¼æ ·å¼ï¼šè¡¨æ ¼å±…å·¦ã€å±…ä¸­ã€å±…å³å¯¹é½
<8> è¡¨æ ¼å®½åº¦(å•ä½cm)ï¼Œè¡¨æ ¼çš„æœ€å¤§å®½åº¦ = é¡µé¢å®½åº¦ - é¡µè¾¹è·å®½åº¦ * 2ï¼Œé¡µé¢å®½åº¦ä¸ºA4(20.99 * 29.6ï¼Œé¡µè¾¹è·ä¸º3.17 * 2.54)çš„æ–‡æ¡£æœ€å¤§è¡¨æ ¼å®½åº¦14.65CMã€‚
--

[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
RowRenderData header = RowRenderData.build(new TextRenderData("FFFFFF", "å§“å"), new TextRenderData("FFFFFF", "å­¦å†"));

RowRenderData row0 = RowRenderData.build("å¼ ä¸‰", "ç ”ç©¶ç”Ÿ");
RowRenderData row1 = RowRenderData.build("æå››", "åšå£«");
RowRenderData row2 = RowRenderData.build("ç‹äº”", "å°å­¦ç”Ÿ");

put("table", new MiniTableRenderData(header, Arrays.asList(row0, row1, row2)));
----
--

[TIP]
====
ç°å®éœ€æ±‚ä¸­è¡¨æ ¼çš„å¸ƒå±€å’Œæ ·å¼å¯èƒ½å¾ˆå¤æ‚ï¼Œæ­¤æ—¶é»˜è®¤è¡¨æ ¼æ ·å¼å°†æ— æ³•æ»¡è¶³ï¼Œå¯ä»¥å°è¯•å…¶å®ƒæ–¹æ¡ˆæ¥è§£å†³ï¼š

- *æ–¹æ¡ˆä¸€*ï¼š æœ‰æ—¶å€™ä»…ä»…å¸Œæœ›å°†é›†åˆå¾ªç¯å±•ç¤ºæˆè¡¨æ ¼è‹¥å¹²è¡Œè€Œå·²ï¼Œå‚è§ link:#hack-loop-table[è¡Œå¾ªç¯æ’ä»¶-HackLoopTableRenderPolicy]ã€‚

- *æ–¹æ¡ˆäºŒ*ï¼š æ¨¡æ¿ä¸­å·²ç»æœ‰ä¸€ä¸ªè¡¨æ ¼ï¼Œæˆ‘ä»¬åªæƒ³åŠ¨æ€çš„å¤„ç†è¡¨æ ¼çš„æŸä¸€éƒ¨åˆ†æ•°æ®ï¼Œpoi-tlæä¾›äº† `DynamicTableRenderPolicy` åŠ¨æ€è¡¨æ ¼ç­–ç•¥ï¼Œå‚è§ link:#example-table[ç¤ºä¾‹-ä»˜æ¬¾é€šçŸ¥ä¹¦]ã€‚

- *æ–¹æ¡ˆä¸‰*ï¼š ç¼–å†™æ’ä»¶ï¼Œå®Œå…¨ç”±è‡ªå·±ç”Ÿæˆæ•´ä¸ªè¡¨æ ¼ï¼Œè¿™ä¸ªæ–¹æ¡ˆéœ€è¦ä½ ç†Ÿæ‚‰Apache POI XWPFTableç›¸å…³APIï¼Œä½†æ˜¯è‡ªç”±åº¦æœ€é«˜ï¼šå‚è§ link:#cus-policy-section[æ’ä»¶-å¼€å‘ä¸€ä¸ªæ’ä»¶]ã€‚
====

=== åˆ—è¡¨
[example]
åˆ—è¡¨æ ‡ç­¾å¯¹åº”Wordçš„ç¬¦å·åˆ—è¡¨æˆ–è€…ç¼–å·åˆ—è¡¨ï¼Œä»¥*å¼€å§‹ï¼š{{*var}}

`NumbericRenderData` æ•°æ®æ¨¡å‹ã€‚
[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
put("list", new NumbericRenderData(new ArrayList<TextRenderData>() {
  {
    add(new TextRenderData("Plug-in function, define your own function"));
    add(new TextRenderData("Supports word text, header..."));
    add(new TextRenderData("Not just templates, but also style templates"));
  }
}));
----
--
åˆ—è¡¨æ ·å¼æ”¯æŒç½—é©¬å­—ç¬¦ã€æœ‰åºæ— åºç­‰ã€‚å‚è§NumbericRenderData.FMT_*ã€‚
[source]
FMT_DECIMAL //1. 2. 3.
FMT_DECIMAL_PARENTHESES //1) 2) 3)
FMT_BULLET //â— â— â—
FMT_LOWER_LETTER //a. b. c.
FMT_LOWER_ROMAN //i â…± â…²
FMT_UPPER_LETTER //A. B. C.

[TIP]
====
**å¦‚æœåˆ—è¡¨çš„æ¯ä¸€é¡¹ä¸æ˜¯ç®€å•çš„æ–‡æœ¬ï¼Œè€Œæ˜¯åŒ…å«å¾ˆå¤šæ–‡æ¡£å†…å®¹ï¼Œæˆ–è€…å¤šçº§åˆ—è¡¨è¯¥æ€ä¹ˆç”Ÿæˆï¼Ÿ**
åŒºå—å¯¹çš„å¾ªç¯åŠŸèƒ½å¯ä»¥å¾ˆå¥½çš„å¾ªç¯åˆ—è¡¨ï¼Œå¹¶ä¸”æ”¯æŒç¼–å·æœ‰åºã€‚
====

=== åŒºå—å¯¹
[example]
åŒºå—å¯¹ç”±å‰åä¸¤ä¸ªæ ‡ç­¾ç»„æˆï¼Œå¼€å§‹æ ‡ç­¾ä»¥?æ ‡è¯†ï¼Œç»“æŸæ ‡ç­¾ä»¥/æ ‡è¯†ï¼š{{?sections}}{{/sections}}

åŒºå—å¯¹å¼€å§‹å’Œç»“æŸæ ‡ç­¾ä¸­é—´å¯ä»¥åŒ…å«å¤šä¸ªå›¾ç‰‡ã€è¡¨æ ¼ã€æ®µè½ã€åˆ—è¡¨ç­‰ï¼Œå¼€å§‹å’Œç»“æŸæ ‡ç­¾å¯ä»¥è·¨å¤šä¸ªæ®µè½ï¼Œä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªæ®µè½ï¼Œä½†æ˜¯å¦‚æœåœ¨è¡¨æ ¼ä¸­ä½¿ç”¨åŒºå—å¯¹ï¼Œå¼€å§‹å’Œç»“æŸæ ‡ç­¾å¿…é¡»åœ¨åŒä¸€ä¸ªå•å…ƒæ ¼å†…ï¼Œå› ä¸ºè·¨å¤šä¸ªå•å…ƒæ ¼çš„æ¸²æŸ“è¡Œä¸ºæ˜¯æœªçŸ¥çš„ã€‚

åŒºå—å¯¹åœ¨å¤„ç†ä¸€ç³»åˆ—æ–‡æ¡£å…ƒç´ çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œä½äºåŒºå—å¯¹ä¸­çš„æ–‡æ¡£å…ƒç´ å¯ä»¥è¢«æ¸²æŸ“é›¶æ¬¡ï¼Œä¸€æ¬¡æˆ–Næ¬¡ï¼Œè¿™å–å†³äºåŒºå—å¯¹çš„å–å€¼ã€‚

Falseæˆ–ç©ºé›†åˆ:: éšè—åŒºå—ä¸­çš„æ‰€æœ‰æ–‡æ¡£å…ƒç´ 
éFalseä¸”ä¸æ˜¯é›†åˆ:: æ˜¾ç¤ºåŒºå—ä¸­çš„æ–‡æ¡£å…ƒç´ ï¼Œæ¸²æŸ“ä¸€æ¬¡
éç©ºé›†åˆ:: æ ¹æ®é›†åˆçš„å¤§å°ï¼Œå¾ªç¯æ¸²æŸ“åŒºå—ä¸­çš„æ–‡æ¡£å…ƒç´ 

NOTE: é›†åˆæ˜¯æ ¹æ®å€¼çš„ç±»å‹æ˜¯å¦å®ç°äº† `Iterable` æ¥å£æ¥åˆ¤æ–­ã€‚

==== Falseæˆ–ç©ºé›†åˆ
å¦‚æœåŒºå—å¯¹çš„å€¼æ˜¯ `null` ã€`false` æˆ–è€…ç©ºçš„é›†åˆï¼Œä½äºåŒºå—ä¸­çš„æ‰€æœ‰æ–‡æ¡£å…ƒç´ å°†ä¸ä¼šæ˜¾ç¤ºï¼Œè¿™å°±ç­‰åŒäºifè¯­å¥çš„æ¡ä»¶ä¸º `false`ã€‚

æ•°æ®:
[example]
--
[source, json]
----
{
  "announce": false
}
----
--

æ¨¡æ¿:

[example]
--
Made it,Ma!{{?announce}}Top of the world!{{/announce}}

Made it,Ma!

{{?announce}}

Top of the world!ğŸ‹

{{/announce}}
--

è¾“å‡º:
[example]
--
Made it,Ma!

Made it,Ma!
--

#### éFalseä¸”ä¸æ˜¯é›†åˆ
å¦‚æœåŒºå—å¯¹çš„å€¼ä¸ä¸º `null` ã€ `false` ï¼Œä¸”ä¸æ˜¯é›†åˆï¼Œä½äºåŒºå—ä¸­çš„æ‰€æœ‰æ–‡æ¡£å…ƒç´ ä¼šè¢«æ¸²æŸ“ä¸€æ¬¡ï¼Œè¿™å°±ç­‰åŒäºifè¯­å¥çš„æ¡ä»¶ä¸º `true`ã€‚

æ•°æ®:
[example]
--
[source, json]
----
{
  "person": { "name": "Sayi" }
}
----
--

æ¨¡æ¿:
[example]
--
{{?person}}  

Hi {{name}}!

{{/person}}
--

è¾“å‡º:

[example]
--
Hi Sayi!
--

IMPORTANT: åŒºå—å¯¹ä¸­æ ‡ç­¾çš„ä½œç”¨åŸŸä¸ºå½“å‰åŒºå—å¯¹ï¼Œå½“ä¸”ä»…å½“åŒºå—å¯¹çš„å€¼æ˜¯ `boolean` ç±»å‹ä¸”ä¸º `true` æ—¶ï¼Œè¿™äº›æ ‡ç­¾ä½œç”¨åŸŸæ‰ä¸ä¼šæ”¹å˜ã€‚

#### éç©ºé›†åˆ
å¦‚æœåŒºå—å¯¹çš„å€¼æ˜¯ä¸€ä¸ªéç©ºé›†åˆï¼ŒåŒºå—ä¸­çš„æ–‡æ¡£å…ƒç´ ä¼šè¢«è¿­ä»£æ¸²æŸ“ä¸€æ¬¡æˆ–è€…Næ¬¡ï¼Œè¿™å–å†³äºé›†åˆçš„å¤§å°ï¼Œç±»ä¼¼äºforeachè¯­æ³•ã€‚

æ•°æ®:
[example]
--
[source, json]
----
{
  "songs": [
    { "name": "Memories" },
    { "name": "Sugar" },
    { "name": "Last Dance(ä¼ä½°)" }
  ]
}
----
--

æ¨¡æ¿:
[example]
--
{{?songs}}

{{name}}

{{/songs}}
--

è¾“å‡º:

[example]
--
Memories

Sugar

Last Dance(ä¼ä½°)
--

[sidebar]
.#thisï¼šå¼•ç”¨å½“å‰å¯¹è±¡
--
åœ¨å¾ªç¯ä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡#thiså¯ä»¥ç›´æ¥å¼•ç”¨å½“å‰è¿­ä»£çš„å¯¹è±¡ã€‚ç”±äº#å’Œå·²æœ‰è¡¨æ ¼æ ‡ç­¾æ ‡è¯†å†²çªï¼Œæ‰€ä»¥åœ¨æ–‡æœ¬æ ‡ç­¾ä¸­éœ€è¦ä½¿ç”¨=å·æ ‡è¯†æ¥è¾“å‡ºæ–‡æœ¬ã€‚

æ•°æ®:
```json
{
  "produces": [
    "application/json",
    "application/xml"
  ]
}
```

Wordæ¨¡æ¿:

```
{{?produces}}
{{=#this}}
{{/produces}}
```

è¾“å‡º:

```
application/json
application/xml
```
--

=== åµŒå¥—
[example]
åµŒå¥—æ˜¯åˆç§°ä¸ºå¯¼å…¥ã€åŒ…å«æˆ–è€…åˆå¹¶ï¼Œä»¥+æ ‡è¯†ï¼š{{+var}}

`DocxRenderData` æ•°æ®æ¨¡å‹ã€‚
[sidebar]
.ä»£ç ç¤ºä¾‹
--
[source, java]
----
List<SegmentData> subData = new ArrayList<SegmentData>();
SegmentData s1 = new SegmentData();
s1.setTitle("ç»å¸¸æŠ±æ€¨çš„è‡ªå·±");
s1.setContent("æ¯ä¸ªäººç”Ÿæ´»å¾—éƒ½ä¸å®¹æ˜“ã€‚");
subData.add(s1);

SegmentData s2 = new SegmentData();
s2.setTitle("æ‹–æ‹–æ‹‰æ‹‰çš„è‡ªå·±");
s2.setContent("èƒ½å¤Ÿä»Šå¤©åšå®Œçš„äº‹æƒ…ï¼Œä¸è¦æ‹–åˆ°æ˜å¤©ï¼Ÿ");
subData.add(s2);

put("docx_word", new DocxRenderData(new File("~/segment.docx"), subData)); <1> <2>
----
<1> ä¸»æ¨¡æ¿åŒ…å«åµŒå¥—æ ‡ç­¾{{+docx_word}}
<2> segment.docxæ˜¯ä¸€ä¸ªåŒ…å«äº†{{title}}å’Œ{{content}}çš„å­æ¨¡æ¿ï¼Œä½¿ç”¨subDataé›†åˆæ¸²æŸ“ååˆå¹¶åˆ°ä¸»æ¨¡æ¿
--

== é…ç½®
poi-tlæä¾›äº†é…ç½®ç±» `Configure` æ¥å­˜å‚¨å¸¸ç”¨çš„è®¾ç½®ï¼Œé…ç½®çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
[source, java]
ConfigureBuilder builder = Configure.newBuilder();
XWPFTemplate.compile("~/template.docx", builder.buid());

=== å‰åç¼€
æˆ‘ä¸€ç›´ä½¿ç”¨ `{{}}` çš„æ–¹å¼æ¥è‡´æ•¬Google CTemplateï¼Œå¦‚æœä½ æ›´åçˆ±freemarker `${}` çš„æ–¹å¼ï¼š
[source, java]
----
builder.buildGramer("${", "}");
----

=== æ ‡ç­¾ç±»å‹
é»˜è®¤çš„å›¾ç‰‡æ ‡ç­¾æ˜¯ä»¥@å¼€å§‹ï¼Œå¦‚æœä½ å¸Œæœ›ä½¿ç”¨%å¼€å§‹ä½œä¸ºå›¾ç‰‡æ ‡ç­¾ï¼š
[source, java]
builder.addPlugin('%', new PictureRenderPolicy());

å¦‚æœä½ ä¸æ˜¯å¾ˆå–œæ¬¢é»˜è®¤çš„æ ‡ç­¾æ ‡è¯†ç±»å‹ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªç”±æ›´æ”¹ï¼š
[source, java]
builder.addPlugin('@', new MiniTableRenderPolicy());
builder.addPlugin('#', new PictureRenderPolicy());

è¿™æ ·{{@var}}å°±å˜æˆäº†è¡¨æ ¼æ ‡ç­¾ï¼Œ{{#var}}å˜æˆäº†å›¾ç‰‡æ ‡ç­¾ï¼Œè™½ç„¶ä¸å»ºè®®æ”¹å˜é»˜è®¤æ ‡ç­¾æ ‡è¯†ï¼Œä½†æ˜¯ä»ä¸­å¯ä»¥çœ‹åˆ°poi-tlæ’ä»¶çš„çµæ´»åº¦ï¼Œåœ¨æ’ä»¶ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•è‡ªå®šä¹‰è‡ªå·±çš„æ ‡ç­¾ã€‚


=== æ ‡ç­¾æ­£åˆ™
æ ‡ç­¾é»˜è®¤æ”¯æŒ**ä¸­æ–‡ã€å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿**çš„ç»„åˆï¼Œæ¯”å¦‚ `{{å®¢æˆ·æ‰‹æœºå·}}` ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥é…ç½®æ ‡ç­¾çš„è§„åˆ™ï¼Œæ¯”å¦‚ä¸å…è®¸ä¸­æ–‡ï¼š
[source, java]
builder.buildGrammerRegex("[\\w]+(\\.[\\w]+)*");

æ¯”å¦‚å…è®¸é™¤äº†æ ‡ç­¾å‰åç¼€å¤–çš„ä»»æ„å­—ç¬¦ï¼š
[source, java]
builder.buildGrammerRegex(RegexUtils.createGeneral("{{", "}}"));

=== è®¡ç®—æ ‡ç­¾å€¼
è®¡ç®—æ ‡ç­¾å€¼æ˜¯æŒ‡å¦‚ä½•åœ¨æ•°æ®ä¸­å¯»æ‰¾æ ‡ç­¾çš„å€¼ï¼Œä½ å¯ä»¥å®Œå…¨è‡ªå®šä¹‰è®¡ç®—çš„æ–¹å¼ã€‚
[source, java]
----
builder.setRenderDataComputeFactory(new RenderDataComputeFactory());
----

TIP: RenderDataComputeFactoryæ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚ï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„å·¥å‚æä¾›æ ‡ç­¾è¡¨è¾¾å¼è®¡ç®—æ¥å£ `RenderDataCompute` çš„å®ç°ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ–¹å¼æ”¯æŒä»»ä½•çš„è¡¨è¾¾å¼å¼•æ“ï¼ŒSpingè¡¨è¾¾å¼æ­£æ˜¯é€šè¿‡ `SpELRenderDataCompute` å®ç°ã€‚

=== Spingè¡¨è¾¾å¼
Spring Expression Language æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ã€‚åœ¨ä½¿ç”¨å‰éœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–ï¼š
[source, xml]
----
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-expression</artifactId>
  <version>4.3.6.RELEASE</version>
</dependency>
----

ä¸ºäº†åœ¨æ¨¡æ¿æ ‡ç­¾ä¸­ä½¿ç”¨SpELè¡¨è¾¾å¼ï¼Œéœ€è¦å°†æ ‡ç­¾é…ç½®ä¸ºSpELæ¨¡å¼ï¼š
[source, java]
----
builder.setElMode(ELMode.SPEL_MODE);
----

==== åŸºæœ¬ä½¿ç”¨
å…³äºSpELçš„å†™æ³•å¯ä»¥å‚è§link:https://docs.spring.io/spring/docs/4.3.26.RELEASE/spring-framework-reference/htmlsingle/#expressions[å®˜æ–¹æ–‡æ¡£]ï¼Œä¸‹é¢ç»™å‡ºä¸€äº›å…¸å‹çš„ç¤ºä¾‹ã€‚
[example]
--
[source]
----
{{name}}
{{name.toUpperCase()}} <1>
{{name == 'poi-tl'}} <2>
{{empty?:'è¿™ä¸ªå­—æ®µä¸ºç©º'}}
{{sex ? 'ç”·' : 'å¥³'}} <3>
{{new java.text.SimpleDateFormat('yyyy-MM-dd HH:mm:ss').format(time)}} <4>
{{price/10000 + 'ä¸‡å…ƒ'}} <5>
{{dogs[0].name}} <6>
----
<1> æ–¹æ³•è°ƒç”¨ï¼Œè½¬å¤§å†™
<2> æ¡ä»¶
<3> ä¸‰ç›®è¿ç®—ç¬¦
<4> æ–¹æ³•è°ƒç”¨ï¼Œæ—¶é—´æ ¼å¼åŒ–
<5> è¿ç®—ç¬¦
<6> æ•°ç»„åˆ—è¡¨ä½¿ç”¨ä¸‹æ ‡è®¿é—®
--

==== SpringELä½œä¸ºåŒºå—å¯¹çš„æ¡ä»¶
Springè¡¨è¾¾å¼ä¸åŒºå—å¯¹ç»“åˆå¯ä»¥å®ç°æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚

æ•°æ®:
[example]
--
[source, json]
----
{
  "desc": "",
  "summary": "Find A Pet",
  "produces": [
    "application/xml"
  ]
}
----
--

æ¨¡æ¿:
[example]
--
{{?desc == null or desc == ''}}{{summary}}{{/}}

{{?produces == null or produces.size() == 0}}æ— {{/}}
--

è¾“å‡º:

[example]
--
Find A Pet
--


TIP: ä½¿ç”¨SpringELæ—¶åŒºå—å¯¹çš„ç»“æŸæ ‡ç­¾å¯ä»¥æ˜¯ï¼š{{/}}ã€‚

=== é”™è¯¯å¤„ç†
poi-tlæ”¯æŒåœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™å®šåˆ¶å¼•æ“çš„è¡Œä¸ºã€‚

==== æ ‡ç­¾æ— æ³•è¢«è®¡ç®—
æ ‡ç­¾æ— æ³•è¢«è®¡ç®—çš„åœºæ™¯æœ‰å‡ ç§ï¼Œæ¯”å¦‚æ¨¡æ¿ä¸­å¼•ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å˜é‡ï¼Œæˆ–è€…çº§è”çš„å‰ç½®ç»“æœä¸æ˜¯ä¸€ä¸ªHashç»“æœï¼Œæ¯”å¦‚ `{{author.name}}` ä¸­authorçš„å€¼ä¸ºnullï¼Œæ­¤æ—¶å°±æ— æ³•è®¡ç®—nameçš„å€¼ã€‚

poi-tlå¯ä»¥åœ¨å‘ç”Ÿè¿™ç§é”™è¯¯æ—¶å¯¹è®¡ç®—ç»“æœè¿›è¡Œé…ç½®ï¼Œé»˜è®¤ä¼šè®¤ä¸ºæ ‡ç­¾å€¼ä¸º `null`ï¼š
[source, java]
----
// é»˜è®¤è¡Œä¸ºï¼Œé™é»˜æ¨¡å¼ï¼Œæ ‡ç­¾è®¡ç®—é”™è¯¯çš„æƒ…å†µä¸‹ç»“æœç½®ä¸ºnull
builder.setElMode(ELMode.POI_TL_STANDARD_MODE);
----

å½“æˆ‘ä»¬éœ€è¦ä¸¥æ ¼æ ¡éªŒæ¨¡æ¿æ˜¯å¦æœ‰äººä¸ºå¤±è¯¯æ—¶ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼š
[source, java]
----
// ä¸¥æ ¼æ¨¡å¼ï¼Œæ ‡ç­¾è®¡ç®—é”™è¯¯çš„æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µä¸‹è¦æ±‚è¡¨è¾¾å¼å¿…é¡»å¯è¢«è®¡ç®—
builder.setElMode(ELMode.POI_TL_STICT_MODE);
----
æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨SpringELè¡¨è¾¾å¼ï¼Œé”™è¯¯å¤„ç†ä¼šéµå¾ªSpringELçš„è§„åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

==== æ ‡ç­¾æ•°æ®ç±»å‹ä¸åˆæ³•
æˆ‘ä»¬çŸ¥é“æ¸²æŸ“å›¾ç‰‡ã€è¡¨æ ¼ç­‰æ ‡ç­¾æ—¶å¯¹æ•°æ®ç±»å‹æ˜¯æœ‰è¦æ±‚çš„ï¼Œå¦‚æœæ•°æ®ä¸åˆæ³•(ä¸ºç©ºæˆ–è€…æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ•°æ®ç±»å‹)ï¼Œå¯ä»¥é…ç½®æ¨¡æ¿æ ‡ç­¾çš„æ¸²æŸ“è¡Œä¸ºã€‚

poi-tlé»˜è®¤çš„è¡Œä¸ºä¼šæ¸…ç©ºæ ‡ç­¾ï¼š
[source, java]
----
builder.setValidErrorHandler(new ClearHandler());
----

å¦‚æœå¸Œæœ›ä¿ç•™æ ‡ç­¾ï¼š
[source, java]
----
builder.setValidErrorHandler(new DiscardHandler());
----

å¦‚æœå¸Œæœ›æ‰§è¡Œä¸¥æ ¼çš„æ ¡éªŒï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼š
[source, java]
----
builder.setValidErrorHandler(new AbortHandler());
----


=== æ¨¡æ¿ç”Ÿæˆæ¨¡æ¿
æ¨¡æ¿å¼•æ“ä¸ä»…ä»…å¯ä»¥ç”Ÿæˆæ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆæ–°çš„æ¨¡æ¿ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æ„é€ è¿™æ ·çš„æ–°æ¨¡æ¿ï¼šæŠŠåŸå…ˆçš„ä¸€ä¸ªæ¨¡æ¿æ ‡ç­¾åˆ†æˆä¸¤ä¸ªæ¨¡æ¿æ ‡ç­¾ï¼š

[source, java]
put("title", "{{title}}\n{{subtitle}}");

=== æ—¥å¿—
poi-tlä½¿ç”¨slf4jä½œä¸ºæ—¥å¿—é—¨é¢ï¼Œä½ å¯ä»¥è‡ªç”±é€‰æ‹©æ—¥å¿—å®ç°ï¼Œæ¯”å¦‚logbackã€log4jç­‰ã€‚æˆ‘ä»¬ä»¥logbackä¸ºä¾‹ï¼š

é¦–å…ˆåœ¨é¡¹ç›®ä¸­æ·»åŠ logbackä¾èµ–ï¼š
[source, xml]
----
<dependency>
  <groupId>ch.qos.logback</groupId>
  <artifactId>logback-core</artifactId>
  <version>1.2.3</version>
</dependency>
<dependency>
  <groupId>ch.qos.logback</groupId>
  <artifactId>logback-classic</artifactId>
  <version>1.2.3</version>
</dependency>
----

ç„¶åé…ç½®logback.xmlæ–‡ä»¶ï¼Œå¯ä»¥é…ç½®æ—¥å¿—çº§åˆ«å’Œæ ¼å¼ï¼š
[source, xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
    </encoder>
  </appender>

  <logger name="com.deepoove.poi" level="debug" additivity="false">
    <appender-ref ref="STDOUT" />
  </logger>
  <root level="info">
    <appender-ref ref="STDOUT" />
  </root>
</configuration>
----

debugçº§åˆ«çš„æ—¥å¿—ä¼šæ‰“å°è§£ææ¸²æŸ“è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œæœ‰åˆ©äºç¨‹åºè°ƒè¯•ï¼Œå¦å¤–åœ¨æ¨¡æ¿å¼•æ“æ‰§è¡Œç»“æŸåä¼šæ‰“å°è€—æ—¶ä¿¡æ¯ï¼š
[example]
--
Successfully Render the template file in 13 millis
--

== æ’ä»¶
æ’ä»¶ï¼Œåˆç§°ä¸º *è‡ªå®šä¹‰å‡½æ•°* ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨æ¨¡æ¿æ ‡ç­¾ä½ç½®å¤„æ‰§è¡Œé¢„å…ˆå®šä¹‰å¥½çš„å‡½æ•°ã€‚ç”±äºæ’ä»¶æœºåˆ¶çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥åœ¨æ¨¡æ¿çš„ä»»ä½•ä½ç½®æ‰§è¡Œä»»ä½•æ“ä½œã€‚

*æ’ä»¶æ˜¯poi-tlçš„æ ¸å¿ƒ*ï¼Œé»˜è®¤çš„æ ‡ç­¾éƒ½æ˜¯é€šè¿‡æ’ä»¶åŠ è½½ã€‚

=== é»˜è®¤æ’ä»¶
poi-tlé»˜è®¤æä¾›äº†äº”ä¸ªç­–ç•¥æ’ä»¶ï¼Œç”¨æ¥å¤„ç†æ–‡æœ¬ã€å›¾ç‰‡ã€åˆ—è¡¨ã€è¡¨æ ¼ã€æ–‡æ¡£åµŒå¥—ç­‰ï¼š

* TextRenderPolicy
* PictureRenderPolicy
* NumbericRenderPolicy
* MiniTableRenderPolicy
* DocxRenderPolicy

ç”±äºè¿™äº”ä¸ªæ’ä»¶å¦‚æ­¤é€šç”¨ï¼Œå› æ­¤å°†è¿™äº›æ’ä»¶æ³¨å†Œä¸ºä¸åŒçš„æ ‡ç­¾ç±»å‹ï¼Œä»è€Œæ­å»ºäº†poi-tlçš„æ ‡ç­¾ä½“ç³»ï¼Œä¹Ÿæ„ç­‘äº†poi-tlé«˜åº¦è‡ªç”±çš„æ’ä»¶æœºåˆ¶ã€‚

[[cus-policy-section]]
=== å¼€å‘ä¸€ä¸ªæ’ä»¶
æ’ä»¶çš„å®ç°å°±æ˜¯è¦å‘Šè¯‰æˆ‘ä»¬åœ¨æ¨¡æ¿çš„æŸä¸ªåœ°æ–¹ç”¨æŸäº›æ•°æ®åšæŸäº›äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° `RenderPolicy` æ¥å£å¼€å‘è‡ªå·±çš„æ¸²æŸ“ç­–ç•¥æ’ä»¶ï¼š
[source, java]
----
public interface RenderPolicy {
  void render(ElementTemplate eleTemplate, Object data, XWPFTemplate template); <1> <2> <3>
}
----
<1> ElementTemplateä»£è¡¨å½“å‰æ ‡ç­¾
<2> dataæ˜¯æ•°æ®æ¨¡å‹
<3> XWPFTemplateä»£è¡¨æ•´ä¸ªæ¨¡æ¿

==== Hello, world
æŒ‰ç…§è¡Œä¸šä¹ ä¿—ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªå°†æ ‡ç­¾æ›¿æ¢ä¸ºHello, worldçš„æ’ä»¶ï¼š
[example]
--
[source, java]
----
public class HelloWorldRenderPolicy implements RenderPolicy {

  @Override
  public void render(ElementTemplate eleTemplate, Object data, XWPFTemplate template) {
    XWPFRun run = ((RunTemplate) eleTemplate).getRun(); <1>
    // String thing = String.valueOf(data);
    String thing = "Hello, world";
    run.setText(thing, 0); <2>
  }

}
----
<1> å½“å‰ä½ç½®XWPFRun
<2> æ¸²æŸ“æ–‡æœ¬hello, world
--

==== AbstractRenderPolicy
poi-tlæä¾›äº†æŠ½è±¡æ¨¡æ¿ç±» `AbstractRenderPolicy` ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›éª¨æ¶æ­¥éª¤å¹¶ä¸”å°†æ•°æ®æ¨¡å‹çš„æ ¡éªŒå’Œæ¸²æŸ“é€»è¾‘åˆ†å¼€ï¼Œä½¿ç”¨æ³›å‹çº¦æŸæ•°æ®ç±»å‹ï¼Œè®©æ’ä»¶å¼€å‘èµ·æ¥æ›´ç®€å•ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹Hello, worldæ’ä»¶çš„å†™æ³•ï¼š
[example]
--
[source, java]
----
public class HelloWorldRenderPolicy extends AbstractRenderPolicy<String> {

  @Override
  public void doRender(RenderContext<String> context) throws Exception {
    // anywhere delegate <1>
    WhereDelegate where = context.getWhereDelegate();
    // any thing
    //String thing = context.getThing();
    String thing = "Hello, world";
    // do
    where.renderText(thing);
  }

}
----
<1> WhereDelegateå¯¹å½“å‰ä½ç½®çš„å§”æ‰˜ï¼Œå°è£…äº†æ“ä½œå½“å‰ä½ç½®çš„ä¸€äº›ä¾¿æ·æ–¹æ³•
--

æ¥ä¸‹æ¥æˆ‘ä»¬å†å†™ä¸€ä¸ªæ›´å¤æ‚çš„æ’ä»¶ï¼Œåœ¨æ¨¡æ¿æ ‡ç­¾ä½ç½®å®Œå®Œå…¨å…¨ä½¿ç”¨ä»£ç åˆ›å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æ“ä½œè¡¨æ ¼ï¼š
[example]
--
[source, java]
----
public class CustomTableRenderPolicy extends AbstractRenderPolicy<Object> {

  @Override
  protected void afterRender(RenderContext<Object> context) {
    // æ¸…ç©ºæ ‡ç­¾
    clearPlaceholder(context, true);
  }

  @Override
  public void doRender(RenderContext<Object> context) throws Exception {

    XWPFRun run = context.getRun();
    // å½“å‰ä½ç½®çš„å®¹å™¨
    BodyContainer bodyContainer = BodyContainerFactory.getBodyContainer(run);
    // å®šä¹‰è¡Œåˆ—
    int row = 10, col = 8;
    // å½“å‰ä½ç½®æ’å…¥è¡¨æ ¼
    XWPFTable table = bodyContainer.insertNewTable(run, row, col);

    // å®šä¹‰è¡¨æ ¼å®½åº¦ã€è¾¹æ¡†å’Œæ ·å¼
    TableTools.widthTable(table, MiniTableRenderData.WIDTH_A4_FULL, col);
    TableTools.borderTable(table, 4);

    // TODO è°ƒç”¨XWPFTable APIæ“ä½œè¡¨æ ¼ï¼šdataå¯¹è±¡å¯ä»¥åŒ…å«ä»»æ„ä½ æƒ³è¦çš„æ•°æ®ï¼ŒåŒ…æ‹¬å›¾ç‰‡æ–‡æœ¬ç­‰
    // TODO è°ƒç”¨MiniTableRenderPolicy.Helper.renderRowæ–¹æ³•å¿«é€Ÿæ–¹ä¾¿çš„æ¸²æŸ“ä¸€è¡Œæ•°æ®
    // TODO è°ƒç”¨TableToolsç±»æ–¹æ³•æ“ä½œè¡¨æ ¼ï¼Œæ¯”å¦‚åˆå¹¶å•å…ƒæ ¼
    // ......
    TableTools.mergeCellsHorizonal(table, 0, 0, 7);
    TableTools.mergeCellsVertically(table, 0, 1, 9);

  }

}
----
CustomTableRenderPolicyé€šè¿‡ `bodyContainer.insertNewTable` åœ¨å½“å‰æ ‡ç­¾ä½ç½®æ’å…¥è¡¨æ ¼ï¼Œä½¿ç”¨XWPFTable APIæ¥æ“ä½œè¡¨æ ¼ã€‚
--
NOTE: éšå¿ƒæ‰€æ¬²çš„æ„æ€æ˜¯åŸåˆ™ä¸ŠApache POIæ”¯æŒçš„æ“ä½œï¼Œéƒ½å¯ä»¥åœ¨å½“å‰æ ‡ç­¾ä½ç½®è¿›è¡Œæ¸²æŸ“ï¼ŒApache POIä¸æ”¯æŒçš„æ“ä½œä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥æ“çºµåº•å±‚XMLæ¥å®ç°ã€‚

=== ä½¿ç”¨æ’ä»¶
æ’ä»¶å¼€å‘å¥½åï¼Œä¸ºäº†è®©æ’ä»¶åœ¨æŸä¸ªæ ‡ç­¾å¤„æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦å°†æ’ä»¶ä¸æ ‡ç­¾ç»‘å®šã€‚

==== å°†æ’ä»¶åº”ç”¨åˆ°æ ‡ç­¾
å½“æˆ‘ä»¬æœ‰ä¸ªæ¨¡æ¿æ ‡ç­¾ä¸º `{{report}}`ï¼Œå¦‚æœå¸Œæœ›åœ¨è¿™ä¸ªä½ç½®åšäº›ä¸ä¸€æ ·æˆ–è€…æ›´å¤æ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ’ä»¶åº”ç”¨åˆ°è¿™ä¸ªæ¨¡æ¿æ ‡ç­¾ï¼š
[source, java]
ConfigureBuilder builder = Configure.newBuilder();
builder.bind("report", new CustomTableRenderPolicy());

ConfigureBuilderé‡‡ç”¨äº†é“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è®¾ç½®å¤šä¸ªæ ‡ç­¾çš„æ’ä»¶ï¼š
[source, java]
builder.bind("report", new CustomTableRenderPolicy())
    bind("name", new MyRenderPolicy());

æ­¤æ—¶ï¼Œ`{{report}}` å°†ä¸å†æ˜¯ä¸€ä¸ªæ–‡æœ¬æ ‡ç­¾ï¼Œè€Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ ‡ç­¾ã€‚

==== å°†æ’ä»¶æ³¨å†Œä¸ºæ–°æ ‡ç­¾ç±»å‹
å½“å¼€å‘çš„æ’ä»¶å…·æœ‰ä¸€å®šçš„é€šç”¨èƒ½åŠ›å°±å¯ä»¥å°†å…¶æ³¨å†Œä¸ºæ–°çš„æ ‡ç­¾ç±»å‹ã€‚æ¯”å¦‚å¢åŠ %æ ‡è¯†ï¼š`{{%var}}`ï¼Œå¯¹åº”è‡ªå®šä¹‰çš„æ¸²æŸ“ç­–ç•¥ `HelloWorldRenderPolicy`ï¼š
[source, java]
builder.addPlugin('%', new HelloWorldRenderPolicy());

æ­¤æ—¶ï¼Œ`{{%var}}` å°†æˆä¸ºä¸€ç§æ–°çš„æ ‡ç­¾ç±»å‹ï¼Œå®ƒçš„æ‰§è¡Œå‡½æ•°æ˜¯ `HelloWorldRenderPolicy`ã€‚

=== è¾…åŠ©ç±»Helper
åœ¨å…§å»ºç­–ç•¥æ’ä»¶ä¸­ï¼Œé€šå¸¸ä¼šæä¾›ä¸€ä¸ªé™æ€Helperè¾…åŠ©ç±»ï¼Œåœ¨æˆ‘ä»¬å®ç°è‡ªå·±çš„RenderPolicyæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›è¾…åŠ©ç±»æ“ä½œæ–‡æ¡£ã€‚
[source, java]
----
// æŸä¸ªä½ç½®æ¸²æŸ“æ–‡æœ¬
TextRenderPolicy.Helper.renderTextRun(XWPFRun, Object);
// æŸä¸ªä½ç½®æ¸²æŸ“å›¾ç‰‡
PictureRenderPolicy.Helper.renderPicture(XWPFRun, PictureRenderData);
// æŸä¸ªä½ç½®æ¸²æŸ“åˆ—è¡¨
NumbericRenderPolicy.Helper.renderNumberic(XWPFRun, NumbericRenderData);
// æ¸²æŸ“è¡¨æ ¼çš„ä¸€è¡Œæ•°æ®
MiniTableRenderPolicy.Helper.renderRow(XWPFTable, int, RowRenderData);
// æ¸²æŸ“å•å…ƒæ ¼
MiniTableRenderPolicy.Helper.renderCell(XWPFTableCell, CellRenderData, TableStyle)
----

=== Plugin Example
æˆ‘æƒ³ç”¨ä¸€ä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹å‘ä½ å±•ç¤º _Do Anything Anywhere_ çš„æƒ³æ³•ï¼Œå®ƒä¸ä½¿ç”¨ä»»ä½•poi-tlçš„é»˜è®¤æ’ä»¶ï¼Œå®Œå…¨ä½¿ç”¨åŒ¿åç±»åˆ›å»ºæ–°æ’ä»¶å®Œæˆã€‚

æ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å…¥å‚æ˜¯anywhereå’Œanythingï¼Œå‡½æ•°ä½“å°±æ˜¯do somethingã€‚

[example]
--
[source, java]
----
// whereç»‘å®špolicy
Configure config = Configure.newBuilder().bind("sea", new AbstractRenderPolicy<String>() { <1>
  @Override
  public void doRender(RenderContext<String> context) throws Exception {
    // anywhere
    XWPFRun where = context.getWhere();
    // anything
    String thing = context.getThing();
    // do æ–‡æœ¬
    where.setText(thing, 0);
  }
}).bind("sea_img", new AbstractRenderPolicy<String>() { <2>
  @Override
  public void doRender(RenderContext<String> context) throws Exception {
    // anywhere delegate
    WhereDelegate where = context.getWhereDelegate();
    // any thing
    String thing = context.getThing();
    // do å›¾ç‰‡
    FileInputStream stream = null;
    try {
      stream = new FileInputStream(thing);
      where.addPicture(stream, XWPFDocument.PICTURE_TYPE_JPEG, 500, 300);
    }
    finally {
      IOUtils.closeQuietly(stream);
    }
    // clear
    clearPlaceholder(context, false);
  }
}).bind("sea_feature", new AbstractRenderPolicy<List<String>>() { <3>
  @Override
  public void doRender(RenderContext<List<String>> context) throws Exception {
    // anywhere delegate
    WhereDelegate where = context.getWhereDelegate();
    // anything
    List<String> thing = context.getThing();
    // do åˆ—è¡¨
    where.renderNumberic(NumbericRenderData.build(thing.toArray(new String[] {})));
    // clear
    clearPlaceholder(context, true);
  }
}).build();

// åˆå§‹åŒ–whereçš„æ•°æ®
HashMap<String, Object> args = new HashMap<String, Object>();
args.put("sea", "Hello, world!");
args.put("sea_img", "src/test/resources/sea.jpg");
args.put("sea_feature", Arrays.asList("é¢æœå¤§æµ·æ˜¥æš–èŠ±å¼€", "ä»Šæœæœ‰é…’ä»Šæœé†‰"));
args.put("sea_location", Arrays.asList("æ—¥è½ï¼šæ—¥è½å±±èŠ±çº¢å››æµ·", "èŠ±æµ·ï¼šä½ æƒ³è¦çš„éƒ½åœ¨è¿™é‡Œ"));

// ä¸€è¡Œä»£ç 
XWPFTemplate.compile("src/test/resources/sea.docx", config).render(args)
    .writeToFile("out_sea.docx");

----
<1> è‡ªå®šä¹‰æ–‡æœ¬æ’ä»¶
<2> è‡ªå®šä¹‰å›¾ç‰‡æ’ä»¶
<3> è‡ªå®šä¹‰åˆ—è¡¨æ’ä»¶
--

[[ref-policy-section]]
=== å¼€å‘ä¸€ä¸ªå¼•ç”¨æ’ä»¶
> å¯¹äºæ–‡æ¡£ä¸­çš„å…ƒç´ (å…ƒç´ åŒ…æ‹¬ä¸é™äºè¡¨æ ¼ã€å›¾ç‰‡)ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªæƒ³æ”¹å˜å®ƒçš„ä¸€ç‚¹ç‚¹å±æ€§ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªæ¨¡æ¿ä¸­å¸ƒå±€å¥½çš„å›¾ç‰‡æˆ‘ä»¬åªæƒ³æ›¿æ¢å›¾ç‰‡å†…å®¹ï¼Œæ™®é€šçš„æ¸²æŸ“ç­–ç•¥å¦‚æœåšåˆ°è¿™ä¸€ç‚¹å¯èƒ½éœ€è¦é‡æ–°åˆ›å»ºæ•´ä¸ªå›¾ç‰‡ï¼Œç„¶åå†è®¾ç½®æœŸæœ›çš„å¸ƒå±€...

å¼•ç”¨æ¸²æŸ“ç­–ç•¥ReferenceRenderPolicyå°±è¿™æ ·è¯ç”Ÿäº†ï¼Œå®ƒæä¾›äº†ç›´æ¥å¼•ç”¨æ–‡æ¡£ä¸­çš„å…ƒç´ å¥æŸ„çš„èƒ½åŠ›ï¼Œ**è¿™ä¸ªé‡è¦çš„ç‰¹æ€§åœ¨æˆ‘ä»¬åªæƒ³æ”¹å˜æ–‡æ¡£ä¸­æŸä¸ªå…ƒç´ æå°ä¸€éƒ¨åˆ†æ ·å¼å’Œå±æ€§çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå…¶ä½™æ ·å¼å’Œå±æ€§éƒ½å¯ä»¥åœ¨æ¨¡æ¿ä¸­é¢„ç½®å¥½ï¼ŒçœŸæ­£çš„æ‰€è§å³æ‰€å¾—**ã€‚
[source,java]
----
public abstract class ReferenceRenderPolicy<T> {

  /**
   * å®šä½å¼•ç”¨å¯¹è±¡
   * 
   * @param template
   * @return
   */
  protected abstract T locate(XWPFTemplate template);

  /**
   * æ“ä½œå¼•ç”¨å¯¹è±¡
   * 
   * @param t
   *      å¼•ç”¨å¯¹è±¡
   * @param template
   *      æ¨¡æ¿
   */
  public abstract void doRender(T t, XWPFTemplate template) throws Exception;
}
----
locateæŠ½è±¡æ–¹æ³•æ˜¯ç”¨æ¥å®šä½å…·ä½“çš„æ–‡æ¡£å…ƒç´ çš„ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°å……æ»¡äº†æƒ³è±¡ç©ºé—´ã€‚poi-tlé»˜è®¤æä¾›äº†ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯é€šè¿‡å…ƒç´ åœ¨æ–‡æ¡£çš„ä½ç½®ï¼Œä¸€ç§æ˜¯åŒ¹é…å…ƒç´ çš„å¯é€‰æ–‡å­—ï¼Œæ¨èä½¿ç”¨å¯é€‰æ–‡å­—å¼•ç”¨å…ƒç´ ã€‚

æˆ‘ä»¬ä»¥poi-tlå†…ç½®çš„å¼•ç”¨æ¸²æŸ“ç­–ç•¥æ’ä»¶ `ReplaceOptionalTextPictureRefRenderPolicy` ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨å¯é€‰æ–‡å­—å¼•ç”¨æ¸²æŸ“ç­–ç•¥æ›¿æ¢ä¸€ä¸ªå ä½å›¾ç‰‡ã€‚

[example]
--
é¦–å…ˆåœ¨æ¨¡æ¿ä¸­ï¼Œä»»æ„è®¾ç½®å›¾ç‰‡å¸ƒå±€å’Œæ ¼å¼(æ¯”å¦‚è¡¬äºæ–‡å­—ä¸‹æ–¹)ï¼Œå¯é€‰æ–‡å­—åœ¨æ ‡é¢˜æˆ–è¯´æ˜ä¸­å¡«å†™"let's img"(æ–‡å­—å†…å®¹æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥è¾“å…¥ä»»ä½•å­—ç¬¦)

image::../ref.png[align='center']

æ¥ä¸‹æ¥å°±å¯ä»¥ç»‘å®šå¼•ç”¨æ¸²æŸ“ç­–ç•¥æ›¿æ¢å›¾ç‰‡äº†ï¼š
[source, java]
----
Configure configure = Configure.newBuilder()
    .referencePolicy( <1> 
      new ReplaceOptionalTextPictureRefRenderPolicy("let's img", <2>
        new FileInputStream("sayi.png"), <3>
        XWPFDocument.PICTURE_TYPE_PNG))
    .build();

XWPFTemplate template = XWPFTemplate.compile("template.docx", configure)
    .render(new HashMap<>());

template.writeToFile("out.docx");
----
<1> ç»‘å®šå¼•ç”¨æ¸²æŸ“ç­–ç•¥
<2> "let's img"ä¸ºåŒ¹é…æ–‡å­—ï¼Œä¼˜å…ˆåŒ¹é…æ ‡é¢˜ï¼Œå†åŒ¹é…è¯´æ˜æ–‡å­—
<3> å¾…æ›¿æ¢çš„å›¾ç‰‡

æœ€ç»ˆè¿è¡Œçš„ç»“æœæ˜¯å›¾ç‰‡å¸ƒå±€æ ¼å¼çš†ä¸å˜ï¼ŒåªæŠŠå›¾ç‰‡æ›¿æ¢æˆäº†å¦ä¸€ä¸ªå›¾ç‰‡ã€‚
--

=== å¯é€‰æ’ä»¶

é™¤äº†äº”ä¸ªé€šç”¨çš„ç­–ç•¥æ’ä»¶å¤–ï¼Œè¿˜å†…ç½®äº†ä¸€äº›é¢å¤–ç”¨é€”çš„æ’ä»¶ã€‚
|===
| `DynamicTableRenderPolicy` |
åŠ¨æ€è¡¨æ ¼æ’ä»¶ï¼Œå…è®¸ç›´æ¥æ“ä½œXWPFTableè¡¨æ ¼å¯¹è±¡
| `HackLoopTableRenderPolicy` |
å¾ªç¯è¡¨æ ¼è¡Œï¼Œä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»
| `BookmarkRenderPolicy` |
ä¹¦ç­¾å’Œé”šç‚¹
| `TOCRenderPolicy` |
å®éªŒåŠŸèƒ½ï¼šç›®å½•ï¼Œæ‰“å¼€æ–‡æ¡£æ—¶éœ€è¦æ›´æ–°åŸŸ
| `IndexRefRenderPolicy` |
æ ¹æ®å…ƒç´ åœ¨æ–‡æ¡£çš„ä½ç½®æ¥æ¸²æŸ“
| `OptionalTextTableRefRenderPolicy` |
æ ¹æ®è¡¨æ ¼çš„å¯é€‰æ–‡å­—æ¥æ“ä½œè¡¨æ ¼
| `ReplaceOptionalTextPictureRefRenderPolicy` |
æ ¹æ®å›¾ç‰‡å¯é€‰æ–‡å­—æ¥æ›¿æ¢å ä½å›¾ç‰‡
|===

NOTE: å¦‚æœä½ å†™äº†ä¸€ä¸ªä¸é”™çš„æ’ä»¶ï¼Œæ¬¢è¿åˆ†äº«ã€‚

[[hack-loop-table]]
==== HackLoopTableRenderPolicy
è¿™æ˜¯ä¸€ä¸ªç‰¹å®šåœºæ™¯çš„æ’ä»¶ï¼Œæ ¹æ®é›†åˆæ•°æ®å¾ªç¯è¡¨æ ¼è¡Œã€‚

[example]
--
.template
è´§ç‰©æ˜ç»†å’Œäººå·¥è´¹åœ¨åŒä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œè´§ç‰©æ˜ç»†éœ€è¦å±•ç¤ºæ‰€æœ‰è´§ç‰©ï¼Œäººå·¥è´¹éœ€è¦å±•ç¤ºæ‰€æœ‰è´¹ç”¨ã€‚`{{goods}}` æ˜¯ä¸ªæ ‡å‡†çš„æ ‡ç­¾ï¼Œå°† `{{goods}}` **ç½®äºå¾ªç¯è¡Œçš„ä¸Šä¸€è¡Œ**ï¼Œå¾ªç¯è¡Œè®¾ç½®è¦å¾ªç¯çš„æ ‡ç­¾å’Œå†…å®¹ï¼Œæ³¨æ„æ­¤æ—¶çš„æ ‡ç­¾åº”è¯¥ä½¿ç”¨ `[]` ï¼Œä»¥æ­¤æ¥åŒºåˆ«poi-tlçš„é»˜è®¤æ ‡ç­¾è¯­æ³•ã€‚åŒç†ï¼Œ`{{labors}}` ä¹Ÿ**ç½®äºå¾ªç¯è¡Œçš„ä¸Šä¸€è¡Œ**ã€‚

image::../example/example_looptable_template.png[align='center']
--

[example]
--
.ä»£ç ç¤ºä¾‹
`{{goods}}` å’Œ `{{labors}}` æ ‡ç­¾å¯¹åº”çš„æ•°æ®åˆ†åˆ«æ˜¯è´§ç‰©é›†åˆå’Œäººå·¥è´¹é›†åˆï¼Œå¦‚æœé›†åˆä¸ºç©ºåˆ™ä¼šåˆ é™¤å¾ªç¯è¡Œã€‚
[source, java]
----
class Goods {
  private int count;
  private String name;
  private String desc;
  private int discount;
  private int tax;
  private int price;
  private int totalPrice;
  // getter setter
}

class Labor {
  private String category;
  private int people;
  private int price;
  private int totalPrice;
  // getter setter
}

List<Labor> labors = new ArrayList<>();
List<Goods> goods = new ArrayList<>();
----

æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ’ä»¶åº”ç”¨åˆ°è¿™ä¸¤ä¸ªæ ‡ç­¾ã€‚
[source, java]
----
HackLoopTableRenderPolicy policy = new HackLoopTableRenderPolicy();

Configure config = Configure.newBuilder()
        .bind("goods", policy).bind("labors", policy).build(); <1>

XWPFTemplate template = XWPFTemplate.compile(resource, config).render(
  new HashMap<String, Object>() {{
      put("goods", goods);
      put("labors", labors);
    }}
);
----
--

[example]
--
.output
æœ€ç»ˆç”Ÿæˆçš„æ–‡æ¡£åˆ—å‡ºäº†æ‰€æœ‰è´§ç‰©å’Œäººå·¥è´¹ã€‚

image::../example/example_looptable_output.png[align='center']
--

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/java/com/deepoove/poi/policy/HackLoopTableRenderPolicyTest.java[JUnit HackLoopTableRenderPolicyTest]

== ç¤ºä¾‹
æ¥ä¸‹æ¥çš„ç¤ºä¾‹é‡‡å–ä¸‰æ®µå¼output+template+data-modelæ¥è¯´æ˜ï¼Œé¦–å…ˆç›´æ¥å±•ç¤ºç”Ÿæˆåçš„æ–‡æ¡£ï¼Œç„¶åä¸€è§ˆæ¨¡æ¿çš„æ ·å­ï¼Œæœ€åæˆ‘ä»¬å¯¹æ•°æ®æ¨¡å‹ä½œä¸ªä»‹ç»ã€‚

=== è½¯ä»¶è¯´æ˜æ–‡æ¡£
[example]
--
.output
éœ€è¦ç”Ÿæˆè¿™æ ·çš„ä¸€ä»½è½¯ä»¶è¯´æ˜ä¹¦ï¼šæ‹¥æœ‰å°é¢å’Œé¡µçœ‰ï¼Œæ­£æ–‡å«æœ‰ä¸åŒæ ·å¼çš„æ–‡æœ¬ï¼Œè¿˜æœ‰è¡¨æ ¼ï¼Œåˆ—è¡¨å’Œå›¾ç‰‡ã€‚ä¸‹è½½æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶link:../example/poi_tl.docx[poi_tl.docx]

image::../example/example_poitl_output.png[align='center']
--

[example]
--
.template
ä½¿ç”¨poi-tlæ ‡ç­¾åˆ¶ä½œæ¨¡æ¿ï¼Œå¯ä»¥çœ‹åˆ°æ ‡ç­¾å¯ä»¥æ‹¥æœ‰æ ·å¼ã€‚

image::../example/example_poitl_template.png[align='center']
--

è¿™ä¸ªç¤ºä¾‹å‘æˆ‘ä»¬å±•ç¤ºäº†poi-tlæœ€åŸºæœ¬çš„èƒ½åŠ›ï¼Œå®ƒåœ¨æ¨¡æ¿æ ‡ç­¾ä½ç½®ï¼Œæ’å…¥åŸºæœ¬çš„æ•°æ®æ¨¡å‹ï¼Œæ‰€è§å³æ‰€å¾—ã€‚

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/XWPFTemplateTest.java[JUnit XWPFTemplateTest]

[[example-table]]
=== ä»˜æ¬¾é€šçŸ¥ä¹¦
[example]
--
.output
éœ€è¦ç”Ÿæˆè¿™æ ·çš„ä¸€ä»½æµè¡Œçš„é€šçŸ¥ä¹¦ï¼šå¤§éƒ¨åˆ†æ•°æ®æ˜¯ç”±è¡¨æ ¼æ„æˆçš„ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªè®¢å•çš„è¡¨æ ¼(å›¾ä¸­ç¬¬ä¸€ä¸ªè¡¨æ ¼)ï¼Œè¿˜éœ€è¦åœ¨ä¸€ä¸ªå·²æœ‰è¡¨æ ¼ä¸­ï¼Œå¡«å……è´§ç‰©æ˜ç»†å’Œäººå·¥è´¹æ•°æ®(å›¾ä¸­ç¬¬äºŒä¸ªè¡¨æ ¼)ã€‚ä¸‹è½½æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶link:../example/payment.docx[payment.docx]

image::../example/example_payment_output.png[align='center']
--

[example]
--
.template
ä½¿ç”¨{{#order}}ç”Ÿæˆpoi-tlæä¾›çš„é»˜è®¤æ ·å¼çš„è¡¨æ ¼ï¼Œè®¾ç½®{{detail_table}}ä¸ºè‡ªå®šä¹‰æ¨¡æ¿æ¸²æŸ“ç­–ç•¥(ç»§æ‰¿æŠ½è±¡è¡¨æ ¼ç­–ç•¥DynamicTableRenderPolicy)ï¼Œè‡ªå®šä¹‰å·²æœ‰è¡¨æ ¼ä¸­éƒ¨åˆ†å•å…ƒæ ¼çš„æ¸²æŸ“ã€‚

image::../example/example_payment_template.png[align='center']
--

è¿™ä¸ªç¤ºä¾‹å‘æˆ‘ä»¬å±•ç¤ºäº†poi-tlåœ¨è¡¨æ ¼æ“ä½œä¸Šçš„ä¸€äº›æ€è€ƒã€‚ç¤ºä¾‹ä¸­è´§ç‰©æ˜ç»†å’Œäººå·¥è´¹çš„è¡¨æ ¼å°±æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¡¨æ ¼ï¼Œè´§ç‰©æ˜ç»†æ˜¯ç”±7åˆ—ç»„æˆï¼Œè¡Œæ•°ä¸å®šï¼Œäººå·¥è´¹æ˜¯ç”±4åˆ—ç»„æˆï¼Œè¡Œæ•°ä¸å®šã€‚

é»˜è®¤è¡¨æ ¼æ•°æ®æ¨¡å‹(MiniTableRenderData)å®ç°äº†æœ€åŸºæœ¬çš„æ ·å¼ï¼Œå½“éœ€æ±‚ä¸­çš„è¡¨æ ¼æ›´åŠ å¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è®¾è®¡å¥½é‚£äº›å›ºå®šçš„éƒ¨åˆ†ï¼Œå°†éœ€è¦åŠ¨æ€æ¸²æŸ“çš„éƒ¨åˆ†å•å…ƒæ ¼äº¤ç»™è‡ªå®šä¹‰æ¨¡æ¿æ¸²æŸ“ç­–ç•¥ã€‚

poi-tlæä¾›äº†æŠ½è±¡è¡¨æ ¼ç­–ç•¥DynamicTableRenderPolicyæ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œ{{detail_table}}æ ‡ç­¾å¯ä»¥åœ¨è¡¨æ ¼å†…çš„ä»»æ„å•å…ƒæ ¼å†…ï¼ŒDynamicTableRenderPolicyä¼šè·å–XWPFTableå¯¹è±¡è¿›è€Œè·å¾—æ“ä½œæ•´ä¸ªè¡¨æ ¼çš„èƒ½åŠ›ã€‚
[source, java]
----
public abstract class DynamicTableRenderPolicy implements RenderPolicy {
  public abstract void render(XWPFTable table, Object data);
}
----

é¦–å…ˆæ–°å»ºæ¸²æŸ“ç­–ç•¥DetailTablePolicyï¼Œç»§æ‰¿äºæŠ½è±¡è¡¨æ ¼ç­–ç•¥ã€‚
[source, java]
----
public class DetailTablePolicy extends DynamicTableRenderPolicy {

  // è´§å“å¡«å……æ•°æ®æ‰€åœ¨è¡Œæ•°
  int goodsStartRow = 2;
  // äººå·¥è´¹å¡«å……æ•°æ®æ‰€åœ¨è¡Œæ•°
  int laborsStartRow = 5;

  @Override
  public void render(XWPFTable table, Object data) {
    if (null == data) return;
    DetailData detailData = (DetailData) data;

    // äººå·¥è´¹å¾ªç¯æ¸²æŸ“
    List<RowRenderData> labors = detailData.getLabors();
    if (null != labors) {
      table.removeRow(laborsStartRow);
      // å¾ªç¯æ’å…¥è¡Œ
      for (int i = 0; i < labors.size(); i++) {
        XWPFTableRow insertNewTableRow = table.insertNewTableRow(laborsStartRow);
        for (int j = 0; j < 7; j++) insertNewTableRow.createCell();

        // åˆå¹¶å•å…ƒæ ¼
        TableTools.mergeCellsHorizonal(table, laborsStartRow, 0, 3);
        // æ¸²æŸ“å•è¡Œäººå·¥è´¹æ•°æ®
        MiniTableRenderPolicy.Helper.renderRow(table, laborsStartRow, labors.get(i));
      }
    }

    // è´§å“æ˜ç»†
    List<RowRenderData> goods = detailData.getGoods();
    if (null != goods) {
      table.removeRow(goodsStartRow);
      for (int i = 0; i < goods.size(); i++) {
        XWPFTableRow insertNewTableRow = table.insertNewTableRow(goodsStartRow);
        for (int j = 0; j < 7; j++) insertNewTableRow.createCell();
        // æ¸²æŸ“å•è¡Œè´§å“æ˜ç»†æ•°æ®
        MiniTableRenderPolicy.Helper.renderRow(table, goodsStartRow, goods.get(i));
      }
    }
  }
}
----

ç„¶åå°†æ¨¡æ¿æ ‡ç­¾{{detail_table}}è®¾ç½®æˆæ­¤ç­–ç•¥ã€‚
[source, java]
Configure config = Configure.newBuilder().bind("detail_table", new DetailTablePolicy()).build();

ä»˜æ¬¾é€šçŸ¥ä¹¦æ˜¯ç”¨æ¥å±•ç¤º `DynamicTableRenderPolicy` çš„ç”¨æ³•ï¼Œç¤ºä¾‹ä¸­è´§ç‰©æ˜ç»†å’Œäººå·¥è´¹ä»…ä»…æ˜¯å¾ªç¯æ¸²æŸ“è¡¨æ ¼è¡Œï¼Œä½¿ç”¨link:#hack-loop-table[HackLoopTableRenderPolicy] æ’ä»¶ä¼šæ›´æ–¹ä¾¿ã€‚

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/example/PaymentExample.java[JUnit PaymentExample]

[[example-okr]]
=== ç›®æ ‡åˆ¶å®š
[example]
--
.output
éœ€è¦æŒ‡å®šä¸€ä»½OKRç›®æ ‡è®¡åˆ’ï¼Œæ¯ä¸ªç›®æ ‡ä½¿ç”¨ä¸€ä¸ªè¡¨æ ¼å‘ˆç°ï¼Œä¸šåŠ¡ç›®æ ‡æœ‰å¤šå°‘ä¸ªä¸ä¸€å®šï¼Œç®¡ç†ç›®æ ‡ä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚ä¸‹è½½æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶link:../example/okr.docx[okr.docx]

image::../example/example_okr_output.png[align='center']
--

[example]
--
.template
å°†è¡¨æ ¼æ”¾åˆ°åŒºå—å¯¹ä¸­ï¼Œå½“åŒºå—å¯¹å–å€¼ä¸ºç©ºé›†åˆæˆ–è€…nullåˆ™ä¸ä¼šå±•ç¤ºç›®æ ‡è¡¨æ ¼ï¼Œå½“åŒºå—å¯¹æ˜¯ä¸€ä¸ªéç©ºé›†åˆåˆ™å¾ªç¯å±•ç¤ºè¡¨æ ¼ã€‚

image::../example/example_okr_template.png[align='center']
--

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†åŒºå—å¯¹çš„å¾ªç¯ForeachåŠŸèƒ½ï¼Œå®ƒå¯ä»¥å¯¹æ–‡æ¡£å†…å®¹è¿›è¡Œå¾ªç¯æ¸²æŸ“ã€‚

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/example/OKRExample.java[JUnit OKRExample]


[[example-resume]]
=== ä¸ªäººç®€å†
[example]
--
.output
éœ€è¦ç”Ÿæˆè¿™æ ·çš„ä¸€ä»½æµè¡Œçš„ä¸ªäººç®€å†ï¼šå·¦ä¾§æ˜¯ä¸ªäººçš„åŸºæœ¬ä¿¡æ¯ï¼ŒæŠ€æœ¯æ ˆæ˜¯ä¸ªå…¸å‹çš„åˆ—è¡¨ï¼Œå³ä¾§æ˜¯ä¸ªäººçš„å·¥ä½œç»å†ï¼Œæ•°é‡ä¸å®šã€‚ä¸‹è½½æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶link:../example/resume.docx[resume.docx]

image::../example/example_resume_output.png[align='center']
--

==== æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨åŒºå—å¯¹æ ‡ç­¾
[example]
--
.template
å·¥ä½œç»å†æ˜¯ä¸€ä¸ªå¾ªç¯æ˜¾ç¤ºçš„å†…å®¹ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒºå—å¯¹æ ‡ç­¾{{?experiences}}{{/experiences}}ã€‚

image::../example/example_iterable_resume_template.png[align='center']
--

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/render/IterableRenderResumeExample.java[JUnit Iterable ResumeExample]

==== æ–¹æ¡ˆäºŒï¼šä½¿ç”¨åµŒå¥—æ ‡ç­¾
[example]
--
.template
å·¥ä½œç»å†å¯ä»¥ä½¿ç”¨åµŒå¥—æ ‡ç­¾ï¼Œæˆ‘ä»¬åˆ¶ä½œä¸¤ä¸ªæ¨¡æ¿ï¼Œä¸€å¥—ä¸»æ¨¡æ¿ç®€å†.docx(ä¸‹å›¾å·¦ä¾§)ï¼Œä¸€å¥—ä¸ºæ–‡æ¡£æ¨¡æ¿segment.docx(ä¸‹å›¾å³ä¾§)ã€‚

image::../example/example_resume_template.png[align='center']
--

çœ‹èµ·æ¥å¾ˆå¤æ‚çš„ç®€å†ï¼Œå…¶å®å¯¹äºæ¨¡ç‰ˆå¼•æ“æ¥è¯´ï¼Œå’Œæ™®é€šçš„Wordæ–‡æ¡£æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¶ä½œå¥½ä¸€ä»½ç®€å†ï¼Œå°†éœ€è¦æ›¿æ¢çš„å†…å®¹ç”¨æ¨¡ç‰ˆæ ‡ç­¾ä»£æ›¿ã€‚

å› ä¸ºæ¨¡ç‰ˆå³æ ·å¼ï¼Œæ¨¡ç‰ˆå¼•æ“æ— éœ€è€ƒè™‘æ ·å¼ï¼Œåªå…³å¿ƒæ•°æ®ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ¶ä½œ10ç§ä¸åŒæ ·å¼çš„ç®€å†æ¨¡æ¿ï¼Œç”¨åŒä¸€ä»½æ•°æ®å»æ¸²æŸ“ã€‚

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/example/ResumeExample.java[JUnit ResumeExample]

[[example-swagger]]
=== Swaggeræ–‡æ¡£
[example]
--
.output
è¿™æ˜¯ä¸€ä»½éå¸¸ä¸“ä¸šçš„Swagger Wordæ–‡æ¡£ï¼Œæ ·å¼ä¼˜é›…ä¸”æœ‰ç€æ¸…æ™°å®Œæ•´çš„æ–‡æ¡£ç»“æ„ï¼Œæ¥å£éœ€è¦å¾ªç¯å±•ç¤ºï¼Œæ¥å£çš„å‚æ•°éœ€è¦å¾ªç¯å±•ç¤ºï¼Œæ¥å£çš„è¿”å›å€¼éœ€è¦å¾ªç¯å±•ç¤ºï¼Œæ•°æ®ç±»å‹æ”¯æŒé”šç‚¹åˆ°å…·ä½“çš„æ¨¡å‹ï¼Œæ¨¡å‹æ”¯æŒä»£ç å—é«˜äº®å±•ç¤ºã€‚ä¸‹è½½æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶link:../example/swagger.docx[swagger.docx]

image::../example/example_swagger_output.png[align='center']
image::../example/example_swagger_output2.png[align='center']
--

[example]
--
.template
ä½¿ç”¨åŒºå—å¯¹æ ‡ç­¾å®Œæˆæ‰€æœ‰å¾ªç¯åŠŸèƒ½ï¼Œå¯ä»¥å®Œç¾çš„æ”¯æŒæœ‰åºå’Œå¤šçº§åˆ—è¡¨ï¼›è¡¨æ ¼ä½¿ç”¨ `HackLoopTableRenderPolicy` æ’ä»¶çš„çº¦å®šï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®Œæˆå‚æ•°ã€è¿”å›å€¼å’Œæ•°æ®æ¨¡å‹è¡¨æ ¼çš„æ¸²æŸ“ï¼›ä½¿ç”¨Springè¡¨è¾¾å¼æ¥æ”¯æŒä¸°å¯Œçš„æ¡ä»¶åˆ¤æ–­ï¼›ä»£ç å—é«˜äº®åªéœ€è¦ä½¿ç”¨æ‹¥æœ‰ä¸åŒæ ·å¼æ–‡æœ¬çš„é›†åˆå¾ªç¯å±•ç¤ºå³å¯ã€‚

image::../example/example_swagger_template1.png[align='center']
image::../example/example_swagger_template2.png[align='center']
--

[example]
--
.ä»£ç ç¤ºä¾‹
[source, java]
----
SwaggerParser swaggerParser = new SwaggerParser();
Swagger swagger = swaggerParser.read("https://petstore.swagger.io/v2/swagger.json");
SwaggerView viewData = convert(swagger); <1>

HackLoopTableRenderPolicy hackLoopTableRenderPolicy = new HackLoopTableRenderPolicy();
Configure config = Configure.newBuilder()
        .bind("parameters", hackLoopTableRenderPolicy)
        .bind("responses", hackLoopTableRenderPolicy)
        .bind("properties", hackLoopTableRenderPolicy)
        .addPlugin('>', new BookmarkRenderPolicy())
        .setElMode(ELMode.SPEL_MODE)
        .build(); <2>

XWPFTemplate template = XWPFTemplate.compile("swagger.docx", config).render(viewData); <3>
template.writeToFile("out_example_swagger.docx");
----
<1> è§£æSwagger.json
<2> é…ç½®æ¨¡æ¿å¼•æ“
<3> Swaggerå¯¼å‡ºWord
--

æ²¡é”™ï¼Œä¸€åˆ‡éƒ½æ˜¯å¦‚æ­¤ç®€æ´ï¼šç®€æ´çš„å¯¼å‡ºä»£ç  ï¼Œç®€æ´çš„Wordæ¨¡æ¿ï¼Œç”šè‡³ç”Ÿæˆçš„Swaggeræ–‡æ¡£éƒ½çœ‹èµ·æ¥é‚£ä¹ˆç®€æ´ï¼Œæ„¿ä¸€åˆ‡å¦‚ä½ æ‰€æ„¿ã€‚

NOTE: æºç å‚è§ link:https://github.com/Sayi/poi-tl/blob/v1.7.2/src/test/java/com/deepoove/poi/tl/example/SwaggerToWordExample.java[JUnit SwaggerToWordExample]

== License
Apache License 2.0

== æºç 
link:https://github.com/Sayi/poi-tl[GitHub]

== æ‰“èµä¸ªå°è´¹
poi-tlå¼€æºçš„åˆè¡·æ˜¯å¸Œæœ›è®©æ‰€æœ‰æœ‰éœ€è¦çš„äººäº«å—Wordæ¨¡æ¿å¼•æ“çš„åŠŸèƒ½ï¼Œå¦‚æœä½ è§‰å¾—å®ƒèŠ‚çœäº†ä½ çš„æ—¶é—´ï¼Œç»™ä½ å¸¦æ¥äº†æ–¹ä¾¿å’Œçµæ„Ÿï¼Œæˆ–è€…è®¤åŒè¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œå¯ä»¥ä¸ºæˆ‘çš„ä»˜å‡ºæ‰“èµç‚¹å°è´¹å“¦ã€‚

image::.././pay.jpeg[width=256, height=280]

[quote, Sayi]
____
poi-tlæ˜¯ç»™ä½ çš„ç¤¼ç‰©!
____

== å¸¸è§é—®é¢˜
[qanda]
å‡ºç°NoSuchMethodError ã€ClassNotFoundException ã€NoClassDefFoundErrorå¼‚å¸¸ï¼Ÿ::
  poi-tlä¾èµ–çš„apache-poiç‰ˆæœ¬æ˜¯4.0.0+ï¼Œå¦‚æœä½ çš„é¡¹ç›®å¼•ç”¨äº†ä½ç‰ˆæœ¬ï¼Œè¯·å‡çº§æˆ–åˆ é™¤ã€‚
æ˜¯å¦æ”¯æŒæ–‡æœ¬æ¡†ï¼Ÿ::
  ä¸æ”¯æŒï¼Œè¡¨æ ¼å¸ƒå±€å¯ä»¥è®¾è®¡å‡ºå‡ ä¹æ‰€æœ‰ä¼˜ç§€ä¸“ä¸šçš„æ–‡æ¡£ï¼Œè¯·ä½¿ç”¨è¡¨æ ¼ã€‚
æ˜¯å¦æ”¯æŒAndroidå®¢æˆ·ç«¯ä½¿ç”¨ï¼Ÿ::
  æœªçŸ¥ï¼Œæœ‰äº›æœ‹å‹å°è¯•æˆåŠŸï¼Œä½†æˆ‘å°šæœªåœ¨Androidç¯å¢ƒä¸­éªŒè¯è¿‡ã€‚
æœ‰æ²¡æœ‰æä¾›å›¾è¡¨ã€æ•°å­¦å…¬å¼æ¨¡æ¿ï¼Ÿ::
  æš‚ä¸æ”¯æŒï¼Œå¦‚æœæ˜¯ç®€å•çš„å›¾è¡¨ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡Javaæä¾›çš„ `BufferedImage` ç±»åˆ›å»ºå›¾ç‰‡åæ’å…¥ã€‚
å¦‚ä½•é€šè¿‡æ ‡ç­¾æŒ‡å®šæ ¼å¼åŒ–å‡½æ•°ï¼Ÿ::
  Springè¡¨è¾¾å¼ï¼Œåº”æœ‰å°½æœ‰ã€‚
å¦‚ä½•åœ¨ä¸€è¡Œä¸­æ˜¾ç¤ºä¸åŒæ ·å¼çš„æ–‡æœ¬ï¼Ÿ::
  å¯èƒ½ä½ éœ€è¦å¤šä¸ªæ ‡ç­¾ï¼›æˆ–è€…ä½¿ç”¨åŒºå—å¯¹ï¼ŒåŒºå—å¯¹çš„é›†åˆæ•°æ®æ˜¯æ‹¥æœ‰ä¸åŒæ ·å¼çš„TextRenderDataã€‚
æˆ‘ä¸æ˜¯å¾ˆç†Ÿæ‚‰Apache POIï¼Œæˆ‘è¯¥æ€ä¹ˆç¼–å†™æ’ä»¶ï¼Ÿ::
  ç¼–å†™æ’ä»¶è¿˜æ˜¯éœ€è¦ç†Ÿæ‚‰ä¸‹POIï¼Œä½ å¯ä»¥å‚è€ƒç°æœ‰æ’ä»¶çš„æºç ï¼Œæˆ–è€…Googleä¸‹Apache POIçš„ç”¨æ³•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…¥é—¨æ•™ç¨‹ï¼šlink:http://deepoove.com/poi-tl/apache-poi-guide.html[Apache POI Wordå¿«é€Ÿå…¥é—¨ , window=_blank]
Apache POIä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œæˆ‘è¯¥æ€ä¹ˆç¼–å†™æ’ä»¶ï¼Ÿ::
  Apache POIåº•å±‚çš„ç»„ä»¶ä¹Ÿæ˜¯ç›´æ¥æ“ä½œXMLçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨POIèƒŒåçš„ç»„ä»¶ã€‚
æœ‰æ²¡æœ‰HTMLè½¬Wordçš„æ’ä»¶ï¼Ÿ::
  ç½‘ä¸Šæœ‰ä¸€äº›è¿™æ ·çš„æ’ä»¶ï¼Œæˆ‘ä¹Ÿå¾ˆæœŸå¾…æœ‰äººèƒ½Pull Requestã€‚
ä¸ºä»€ä¹ˆæ²¡æœ‰æŠ€æœ¯ç¾¤ï¼Ÿ::
  æŠ€æœ¯ç¾¤åªåœ¨ä½ ç¬¬ä¸€æ¬¡åŠ å…¥çš„æ—¶å€™æœ‰ç”¨ï¼Œåæ¥å°±ä¼šæˆä¸ºæ¼äººçš„ç¾¤ã€‚